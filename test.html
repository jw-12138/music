<!DOCTYPE html>
<html data-version="1.0.3 beta">

<head>
    <meta charset="UTF-8">
    <title>Jacky.Q</title>
    <meta name="viewport" content="width=device-width, initial-scale=1 ,minimum-scale=1, maximum-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <style>
        .wave{height: 100px;display: flex;justify-content: flex-start;align-items: center;overflow:hidden;}
        .wave.one{align-items: flex-end;}
        .wave.two{align-items: flex-start;}
        .wave.three{height: 200px;}
        .wave .point{background-color: #666;border-radius: 5px;min-height: 1px;width: 3px;margin-right: 1px;}
        .wave.one .point{border-radius: 5px 5px 0 0;}
        .wave.two .point{border-radius: 0 0 5px 5px;}
        .wavePic{height: 100px;display: block;width: 100%;}
    </style>
</head>

<body>
    <button class="play">play</button>
    <audio class="mp3" src="src/addictionToYou/audio.mp3" controls="controls" style="width: 100%;"></audio>
    <img class="wavePic" src="src/addictionToYou/wave.png" alt="">
    <div class="wave one">
        
    </div>
    <div class="wave two">
        
    </div>
    <div class="wave three">
        
    </div>
    <script type="text/javascript" src="js/jquery.min.js"></script>
    <script type="text/javascript">
    $(function() {
        let mp3 = $('.mp3')[0];
        let audioRate = 0;
        let channelOne = 0;
        let channelTwo = 0;
        let audioCtx = new(window.AudioContext || window.webkitAudioContext)();

        function getData() {
            var request = new XMLHttpRequest();
            request.open('GET', 'src/addictionToYou/audio.mp3', true);
            request.responseType = 'arraybuffer';
            request.onload = function() {
                var audioData = request.response;
                audioCtx.decodeAudioData(audioData).then(function(decodedData) {
                    // use the decoded data here
                    console.log(decodedData)
                    audioRate = decodedData.sampleRate;
                    channelOne = decodedData.getChannelData(0);
                    channelTwo = decodedData.getChannelData(1);
                    console.log(channelOne)

                    // set bar width in px
                    let barWidth = 3 + 1;

                    let splitPoint = Math.floor($('body').width() / barWidth);
                    let x = channelOne.length / splitPoint;
                    let data = {
                        c0:[],
                        c1:[]
                    };
                    for (let i = 1; i <= splitPoint ; i++) {
                        let r = parseInt(x * i);
                        let cr1 = channelOne[r];
                        let cr2 = channelTwo[r];
                        let h1;
                        let h2;
                        let h3;
                        if(isNaN(cr1) || isNaN(cr2)){
                            break;
                        }
                        data.c0.push(cr1);
                        data.c1.push(cr2);
                        h1 = Math.abs(cr1) * 100;
                        h2 = Math.abs(cr2) * 100;
                        h3 = h1 + h2;
                        $('.wave.one').append('<div class="point" style="height:'+h1+'px"></div>');
                        $('.wave.two').append('<div class="point" style="height:'+h2+'px"></div>');
                        $('.wave.three').append('<div class="point" style="height:'+h3+'px"></div>');
                    }
                    console.log(data)
                    mp3.play();
                });
            }
            request.send();
        }
        $('.play').click(function(){
            getData();
            $('.wave').html('');
        });
    });
    </script>
</body>

</html>