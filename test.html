<!DOCTYPE html>
<html data-version="1.0.3 beta">

<head>
    <meta charset="UTF-8">
    <title>Jacky.Q</title>
    <meta name="viewport" content="width=device-width, initial-scale=1 ,minimum-scale=1, maximum-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <style>
        .wave{height: 100px;display: flex;justify-content: flex-start;align-items: center;}
        .wave .point{background-color: #666;width: 5px;margin-right: 1px;border-radius: 5px;}
    </style>
</head>

<body>
    <audio class="audio" src="src/leave/audio.mp3" controls="controls"></audio>
    <button class="play">play</button>
    <div class="wave one">
        
    </div>
    <div class="wave two">
        
    </div>
    <script type="text/javascript" src="js/jquery.min.js"></script>
    <script type="text/javascript">
    $(function() {
        let mp3 = $('.audio')[0];
        let audioCtx = new(window.AudioContext || window.webkitAudioContext)();

        function getData() {
            var request = new XMLHttpRequest();
            request.open('GET', 'src/leave/audio.mp3', true);
            request.responseType = 'arraybuffer';
            request.onload = function() {
                var audioData = request.response;
                audioCtx.decodeAudioData(audioData).then(function(decodedData) {
                    // use the decoded data here
                    console.log(decodedData)
                    let channelOne = decodedData.getChannelData(0);
                    let channelTwo = decodedData.getChannelData(1);
                    let x1 = channelOne.length / 200;
                    let x2 = channelTwo.length / 200;
                    for (let i = 1; i <= 200 ; i++) {
                        let r1 = parseInt(x1 * i);
                        let r2 = parseInt(x2 * i);
                        let cr1 = channelOne[r1];
                        let cr2 = channelTwo[r2];
                        let h1;
                        let h2;
                        if(isNaN(cr1)){
                            break;
                        }
                        h1 = (cr1 + 1) * 50;
                        h2 = (cr2 + 1) * 50;
                        $('.wave.one').append('<div class="point" style="height:' + h1 + 'px"></div>');
                        $('.wave.two').append('<div class="point" style="height:' + h2 + 'px"></div>');
                    }
                });

            }
            request.send();
        }
        $('.play').click(function(){
            mp3.play();
            getData();
        });
    });
    </script>
</body>

</html>